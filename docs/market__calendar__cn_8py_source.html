<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>stock: tools/date_util/market_calendar_cn.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">stock
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4eeb864c4eec08c7d6b9d3b0352cfdde.html">tools</a></li><li class="navelem"><a class="el" href="dir_7548f468fadc8037bcecf4806438d99f.html">date_util</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">market_calendar_cn.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="market__calendar__cn_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacemarket__calendar__cn.html">    1</a></span>&#160;<span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"># WINDOWS_GUARANTEED</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">import</span> os</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">import</span> time</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">import</span> pytz</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">from</span> tushare <span class="keyword">import</span> trade_cal</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">import</span> re</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">from</span> tools.data.file_hdl <span class="keyword">import</span> load_pickle, save_pickle</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">from</span> tools.data.path_hdl <span class="keyword">import</span> path_expand, directory_ensure, file_exist</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacetools_1_1io.html">tools.io</a> <span class="keyword">import</span> logging</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"># REGDIR( calendar )</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"># noinspection PyBroadException,PyUnusedLocal</span></div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html">   22</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html">MktCalendar</a>:</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="stringliteral">    Market Calendar is a fundamental module of the whole project. Say if you want to get tick data 20 trade days ago,</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="stringliteral">    or if you want to predict stock price 3 trade days later given a predict function. This class maintain a market</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral">    calendar and can return all kind of date/time described by functions or constants.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment"># DEPENDENCY( tushare pytz )</span></div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a480f8d7db6d812ee624d4be7e1372c5f">   30</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a480f8d7db6d812ee624d4be7e1372c5f">__init__</a>(self, tz=&#39;Asia/Shanghai&#39;, mkt=&#39;CN&#39;):</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">        Within the scope of MktCalendar of CN, we define &quot;local timezone&quot; as &#39;Asia/Shanghai&#39;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral">        :param tz:      timezone</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">        :param mkt:     stock market</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="comment"># currently only considered tz=&#39;Asia/Shanghai&#39;, mkt=&#39;CN&#39;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="comment"># calendar fetched using tushare.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="comment"># important: need to call load_calendar() after creating new instance.</span></div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac2bd5c4d78a5e3976f4278479d0ee7f9">   39</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac2bd5c4d78a5e3976f4278479d0ee7f9">timezone</a> = tz</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8e5eccdc4b86dfd4e896eef215bef286">   40</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8e5eccdc4b86dfd4e896eef215bef286">market</a> = mkt</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <a class="code" href="namespacepath__hdl.html#a23c55bc606a7183504481b311a93be0a">directory_ensure</a>(<a class="code" href="namespacepath__hdl.html#ae87fc63ccf0676ae841291bbf8c0e2dc">path_expand</a>(<span class="stringliteral">&#39;calendar&#39;</span>))</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a65ef493d830b70b37641628efee1fa04">   43</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a65ef493d830b70b37641628efee1fa04">path_full_cal</a> = os.path.join(<a class="code" href="namespacepath__hdl.html#ae87fc63ccf0676ae841291bbf8c0e2dc">path_expand</a>(<span class="stringliteral">&#39;calendar&#39;</span>), <span class="stringliteral">&quot;%s.csv&quot;</span> % self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8e5eccdc4b86dfd4e896eef215bef286">market</a>)</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af69941a2b76a04420320c9ae2e468c13">   44</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af69941a2b76a04420320c9ae2e468c13">path_trade_cal</a> = os.path.join(<a class="code" href="namespacepath__hdl.html#ae87fc63ccf0676ae841291bbf8c0e2dc">path_expand</a>(<span class="stringliteral">&#39;calendar&#39;</span>), <span class="stringliteral">&quot;%s_trade.csv&quot;</span> % self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8e5eccdc4b86dfd4e896eef215bef286">market</a>)</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a0116b4b1d0367ef73803a42d23fff458">   45</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a0116b4b1d0367ef73803a42d23fff458">path_quick_dict</a> = os.path.join(<a class="code" href="namespacepath__hdl.html#ae87fc63ccf0676ae841291bbf8c0e2dc">path_expand</a>(<span class="stringliteral">&#39;calendar&#39;</span>), <span class="stringliteral">&quot;%s_quick_dict.pickle&quot;</span> % self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8e5eccdc4b86dfd4e896eef215bef286">market</a>)</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a273ec6bac1529b02391985a902ba857f">   46</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a273ec6bac1529b02391985a902ba857f">path_lr_pair_list</a> = os.path.join(<a class="code" href="namespacepath__hdl.html#ae87fc63ccf0676ae841291bbf8c0e2dc">path_expand</a>(<span class="stringliteral">&#39;calendar&#39;</span>), <span class="stringliteral">&quot;%s_lr_pair_list.pickle&quot;</span> % self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8e5eccdc4b86dfd4e896eef215bef286">market</a>)</div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af48e398f69caa9289fbb1351b697e03d">   47</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af48e398f69caa9289fbb1351b697e03d">path_lr_pair_dict</a> = os.path.join(<a class="code" href="namespacepath__hdl.html#ae87fc63ccf0676ae841291bbf8c0e2dc">path_expand</a>(<span class="stringliteral">&#39;calendar&#39;</span>), <span class="stringliteral">&quot;%s_lr_pair_dict.pickle&quot;</span> % self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8e5eccdc4b86dfd4e896eef215bef286">market</a>)</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a7ea0dda03522caa37e91076040b6f81a">   49</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a7ea0dda03522caa37e91076040b6f81a">date_boundary</a> = (<span class="keywordtype">None</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">   50</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">   51</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">   52</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac3f63867cb8bf9cea20fdd7bb8abaee5">load_calendar</a>()</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4e96ed8af863b39515fdc5bfa7d275c">   55</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4e96ed8af863b39515fdc5bfa7d275c">lr_pair_list</a> = []</div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9e99dea0131e784ba92591f950ad1f01">   56</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9e99dea0131e784ba92591f950ad1f01">lr_pair_dict</a> = {}</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8109498601a070da90e5027ab95b0e50">load_lr_pair</a>()</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">   59</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(self, ret_format=&#39;dt&#39;):</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">        return current date or time within self.timezone</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral">        :param ret_format: &#39;YYYY-MM-DD&#39; given &#39;d&#39;, &#39;HH:MM:SS&#39; given &#39;t&#39;, &#39;YYYY-MM-DD&amp;HH:MM:SS&#39; given &#39;dt&#39;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="stringliteral">        :return: current date&amp;time in string format</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        current_time = time.time()</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        utc_now, now = datetime.utcfromtimestamp(current_time), datetime.fromtimestamp(current_time)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        local_now = utc_now.replace(tzinfo=pytz.utc).astimezone(pytz.timezone(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac2bd5c4d78a5e3976f4278479d0ee7f9">timezone</a>))</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">if</span> ret_format == <span class="stringliteral">&#39;d&#39;</span>:</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">return</span> local_now.strftime(<span class="stringliteral">&quot;%Y-%m-%d&quot;</span>)</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">elif</span> ret_format == <span class="stringliteral">&#39;t&#39;</span>:</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="keywordflow">return</span> local_now.strftime(<span class="stringliteral">&quot;%H:%M:%S&quot;</span>)</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">else</span>:  <span class="comment"># format == &#39;dt&#39;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">return</span> local_now.strftime(<span class="stringliteral">&quot;%Y-%m-%d&amp;%H:%M:%S&quot;</span>)</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a373b8705da9710281ead8203261b5eba">   76</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a373b8705da9710281ead8203261b5eba">neighbor_trade_date</a>(self, of_which_idx, direction):</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">        Given an index of date in full_calendar, return neighbor trade date of it.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">        :param of_which_idx:    int</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">        :param direction:       string, prev or next</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral">        :return:                string, YYYY-MM-DD</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        idx = of_which_idx</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">while</span> <span class="keyword">True</span>:</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordflow">if</span> direction == <span class="stringliteral">&#39;prev&#39;</span>:</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                idx -= 1</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="keywordflow">else</span>:  <span class="comment"># direction == &#39;next&#39;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                idx += 1</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">if</span> (idx &lt; 0) | (idx &gt;= len(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.index)):</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.iloc[idx][<span class="stringliteral">&#39;mkt_open&#39;</span>]:</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="keywordflow">return</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.iloc[idx][<span class="stringliteral">&#39;date&#39;</span>]</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ab83d71ecc48af728de72c8f34608616e">   94</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ab83d71ecc48af728de72c8f34608616e">neighbor_trade_date_given_date</a>(self, of_which_date, direction):</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="stringliteral">        Given an date, return neighbor trade date of it.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="stringliteral">        :param of_which_date:   string, YYYY-MM-DD</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="stringliteral">        :param direction:       string, prev or next</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="stringliteral">        :return:                string, YYYY-MM-DD</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            idx = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[of_which_date][<span class="stringliteral">&#39;idx_full_cal&#39;</span>]</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a373b8705da9710281ead8203261b5eba">neighbor_trade_date</a>(idx, direction)</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <a class="code" href="namespaceio.html#a853b98c40a2878e8c0710e0d926c1e4d">logging</a>(<span class="stringliteral">&#39;MktCalendar&#39;</span>, <span class="stringliteral">&quot;[ ERROR ] neighbor_trade_date_given_date %s&quot;</span> % e, method=<span class="stringliteral">&#39;all&#39;</span>)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a6e1ee371ee4a410ca54d56e368cccb38">  107</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a6e1ee371ee4a410ca54d56e368cccb38">fetch_calendar</a>(self):</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="stringliteral">        Fetch market calendar from tushare source</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a> = <a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>()</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.rename(columns={<span class="stringliteral">&#39;calendarDate&#39;</span>: <span class="stringliteral">&#39;date&#39;</span>, <span class="stringliteral">&#39;isOpen&#39;</span>: <span class="stringliteral">&#39;mkt_open&#39;</span>}, inplace=<span class="keyword">True</span>)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a> = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[<span class="stringliteral">&#39;mkt_open&#39;</span>] == 1].reset_index().drop([<span class="stringliteral">&#39;index&#39;</span>], axis=1)</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[<span class="stringliteral">&#39;index&#39;</span>] = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.index  <span class="comment"># add this column to get a universal fetching routine</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>[<span class="stringliteral">&#39;index&#39;</span>] = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>.index</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a7ea0dda03522caa37e91076040b6f81a">date_boundary</a> = (self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[<span class="stringliteral">&#39;date&#39;</span>].tolist()[0], self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[<span class="stringliteral">&#39;date&#39;</span>].tolist()[-1])</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.to_csv(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a65ef493d830b70b37641628efee1fa04">path_full_cal</a>, index=<span class="keyword">False</span>)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>.to_csv(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af69941a2b76a04420320c9ae2e468c13">path_trade_cal</a>, index=<span class="keyword">False</span>)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4eef9a337b77e313d5e062b999d9170">  121</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4eef9a337b77e313d5e062b999d9170">build_quick_dict</a>(self):</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="stringliteral">        once quick_dict is built, you can search &#39;mkt_open&#39;, &#39;idx_full_cal&#39;, &#39;idx_trade_cal&#39;, &#39;prev_trade_date&#39;,</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="stringliteral">        &#39;next_trade_date&#39; of a specified date YYYY-MM-DD.</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="stringliteral">        Should only be called after fetch_calendar</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment"># keys: mkt_open, idx_full_cal, idx_trade_cal, prev_trade_date, next_trade_date</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a> = {}</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        row_len = len(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.index)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">for</span> idx <span class="keywordflow">in</span> range(0, row_len):</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <a class="code" href="namespaceio.html#a853b98c40a2878e8c0710e0d926c1e4d">logging</a>(<span class="stringliteral">&#39;MktCalendar&#39;</span>, <span class="stringliteral">&quot;[ INFO ] build quick dict %d/%d&quot;</span> % (idx + 1, row_len), method=<span class="stringliteral">&#39;all&#39;</span>)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            date = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.iloc[idx][<span class="stringliteral">&#39;date&#39;</span>]</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            mkt_open = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.iloc[idx][<span class="stringliteral">&#39;mkt_open&#39;</span>]</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            idx_full_cal = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.iloc[idx][<span class="stringliteral">&#39;index&#39;</span>]</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            idx_trade_cal = -1 <span class="keywordflow">if</span> mkt_open == 0 <span class="keywordflow">else</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>[self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>[<span class="stringliteral">&#39;date&#39;</span>] == date].iloc[0][<span class="stringliteral">&#39;index&#39;</span>]</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            prev_trade_date = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a373b8705da9710281ead8203261b5eba">neighbor_trade_date</a>(idx_full_cal, <span class="stringliteral">&#39;prev&#39;</span>)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            next_trade_date = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a373b8705da9710281ead8203261b5eba">neighbor_trade_date</a>(idx_full_cal, <span class="stringliteral">&#39;next&#39;</span>)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[date] = {<span class="stringliteral">&#39;mkt_open&#39;</span>: mkt_open, <span class="stringliteral">&#39;idx_full_cal&#39;</span>: idx_full_cal,</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                     <span class="stringliteral">&#39;idx_trade_cal&#39;</span>: idx_trade_cal, <span class="stringliteral">&#39;prev_trade_date&#39;</span>: prev_trade_date,</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                                     <span class="stringliteral">&#39;next_trade_date&#39;</span>: next_trade_date}</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="namespacefile__hdl.html#a527e1e4ff7d61672c558c4fefaa414d2">save_pickle</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>, self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a0116b4b1d0367ef73803a42d23fff458">path_quick_dict</a>)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac3f63867cb8bf9cea20fdd7bb8abaee5">  143</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac3f63867cb8bf9cea20fdd7bb8abaee5">load_calendar</a>(self):</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="stringliteral">        Load calendar.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespacepath__hdl.html#a297c678baf109aff55206da9d08e5ecd">file_exist</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a65ef493d830b70b37641628efee1fa04">path_full_cal</a>) &amp; <a class="code" href="namespacepath__hdl.html#a297c678baf109aff55206da9d08e5ecd">file_exist</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af69941a2b76a04420320c9ae2e468c13">path_trade_cal</a>) &amp; <a class="code" href="namespacepath__hdl.html#a297c678baf109aff55206da9d08e5ecd">file_exist</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a0116b4b1d0367ef73803a42d23fff458">path_quick_dict</a>):</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a6e1ee371ee4a410ca54d56e368cccb38">fetch_calendar</a>()</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4eef9a337b77e313d5e062b999d9170">build_quick_dict</a>()</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a> = pd.read_csv(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a65ef493d830b70b37641628efee1fa04">path_full_cal</a>)</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a> = pd.read_csv(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af69941a2b76a04420320c9ae2e468c13">path_trade_cal</a>)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a> = <a class="code" href="namespacefile__hdl.html#aca9e5fce492fec7b74e93ea7e4a7e5b8">load_pickle</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a0116b4b1d0367ef73803a42d23fff458">path_quick_dict</a>)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a7ea0dda03522caa37e91076040b6f81a">date_boundary</a> = (self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[<span class="stringliteral">&#39;date&#39;</span>].tolist()[0], self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[<span class="stringliteral">&#39;date&#39;</span>].tolist()[-1])</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:  <span class="comment"># calendar files broken, re-fetch and rebuild everything</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <a class="code" href="namespaceio.html#a853b98c40a2878e8c0710e0d926c1e4d">logging</a>(<span class="stringliteral">&quot;MktCalendar&quot;</span>, <span class="stringliteral">&quot;[ INFO ] Rebuild calendar...&quot;</span>, method=<span class="stringliteral">&#39;all&#39;</span>)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a6e1ee371ee4a410ca54d56e368cccb38">fetch_calendar</a>()</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4eef9a337b77e313d5e062b999d9170">build_quick_dict</a>()</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8109498601a070da90e5027ab95b0e50">  160</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8109498601a070da90e5027ab95b0e50">load_lr_pair</a>(self):</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="stringliteral">        lr_pair contains information to calculate how many seconds between 2 given time, pretty useful for mkt_monitor.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespacepath__hdl.html#a297c678baf109aff55206da9d08e5ecd">file_exist</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af48e398f69caa9289fbb1351b697e03d">path_lr_pair_dict</a>) &amp; <a class="code" href="namespacepath__hdl.html#a297c678baf109aff55206da9d08e5ecd">file_exist</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a273ec6bac1529b02391985a902ba857f">path_lr_pair_list</a>):</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a5716151c1c0bdb57228f3bdba6696aa7">generate_lr_pair</a>()</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9e99dea0131e784ba92591f950ad1f01">lr_pair_dict</a> = <a class="code" href="namespacefile__hdl.html#aca9e5fce492fec7b74e93ea7e4a7e5b8">load_pickle</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af48e398f69caa9289fbb1351b697e03d">path_lr_pair_dict</a>)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4e96ed8af863b39515fdc5bfa7d275c">lr_pair_list</a> = <a class="code" href="namespacefile__hdl.html#aca9e5fce492fec7b74e93ea7e4a7e5b8">load_pickle</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a273ec6bac1529b02391985a902ba857f">path_lr_pair_list</a>)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <a class="code" href="namespaceio.html#a853b98c40a2878e8c0710e0d926c1e4d">logging</a>(<span class="stringliteral">&quot;MktCalendar&quot;</span>, <span class="stringliteral">&quot;[ INFO ] Rebuild LR-Pairs&quot;</span>, method=<span class="stringliteral">&#39;all&#39;</span>)</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a5716151c1c0bdb57228f3bdba6696aa7">generate_lr_pair</a>()</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a5716151c1c0bdb57228f3bdba6696aa7">  173</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a5716151c1c0bdb57228f3bdba6696aa7">generate_lr_pair</a>(self):</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="stringliteral">        lr_pair contains information to calculate how many seconds between 2 given time, pretty useful for mkt_monitor.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="stringliteral">        should only be called after fetch_calendar</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        trade_date_list = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[<span class="stringliteral">&#39;mkt_open&#39;</span>] == 1][<span class="stringliteral">&#39;date&#39;</span>].tolist()</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        tl = [<span class="stringliteral">&quot;09:30:00&quot;</span>, <span class="stringliteral">&quot;11:30:00&quot;</span>, <span class="stringliteral">&quot;13:00:00&quot;</span>, <span class="stringliteral">&quot;15:00:00&quot;</span>]</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        open_from = [<span class="stringliteral">&quot;09:30:00&quot;</span>, <span class="stringliteral">&quot;13:00:00&quot;</span>]</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        close_from = [<span class="stringliteral">&quot;11:30:00&quot;</span>, <span class="stringliteral">&quot;15:00:00&quot;</span>]</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        day_pair_list = []</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> trade_date_list:</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            day_pair = [(i, t) <span class="keywordflow">for</span> t <span class="keywordflow">in</span> tl]</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            day_pair_list += day_pair</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">while</span> len(day_pair_list) &gt; 1:</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            pair_l = day_pair_list.pop(0)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            pair_r = day_pair_list.pop(0)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            date_time_format = <span class="stringliteral">&#39;%Y-%m-%d&amp;%H:%M:%S&#39;</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            secs = int(</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                (datetime.strptime(<span class="stringliteral">&quot;%s&amp;%s&quot;</span> % pair_r, date_time_format) -</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                 datetime.strptime(<span class="stringliteral">&quot;%s&amp;%s&quot;</span> % pair_l, date_time_format)).total_seconds())</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">if</span> (pair_l[1] <span class="keywordflow">in</span> open_from) &amp; (pair_r[1] <span class="keywordflow">in</span> close_from):</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                period_open = <span class="keyword">True</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="keywordflow">else</span>:  <span class="comment"># should hold if data in good shape</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                period_open = <span class="keyword">False</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4e96ed8af863b39515fdc5bfa7d275c">lr_pair_list</a>.append((<span class="stringliteral">&quot;%s&amp;%s&quot;</span> % pair_l, <span class="stringliteral">&quot;%s&amp;%s&quot;</span> % pair_r, period_open, secs))</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="comment"># (&#39;%Y-%m-%d&amp;%H:%M:%S&#39;, &#39;%Y-%m-%d&amp;%H:%M:%S&#39;, True, 7200)</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            day_pair_list.insert(0, pair_r)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">for</span> (idx, i) <span class="keywordflow">in</span> enumerate(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4e96ed8af863b39515fdc5bfa7d275c">lr_pair_list</a>):</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            k = (i[0], i[1])</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            v = (idx, i[2], i[3])</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9e99dea0131e784ba92591f950ad1f01">lr_pair_dict</a>[k] = v</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <a class="code" href="namespacefile__hdl.html#a527e1e4ff7d61672c558c4fefaa414d2">save_pickle</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4e96ed8af863b39515fdc5bfa7d275c">lr_pair_list</a>, self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a273ec6bac1529b02391985a902ba857f">path_lr_pair_list</a>)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="namespacefile__hdl.html#a527e1e4ff7d61672c558c4fefaa414d2">save_pickle</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9e99dea0131e784ba92591f950ad1f01">lr_pair_dict</a>, self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#af48e398f69caa9289fbb1351b697e03d">path_lr_pair_dict</a>)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">  211</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(self, date, key):</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral">        given a date, search it&#39;s property specified by key.</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="stringliteral">        :param date:    string, YYYY-MM-DD</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="stringliteral">        :param key:     &#39;mkt_open&#39;, &#39;idx_full_cal&#39;, &#39;idx_trade_cal&#39;, &#39;prev_trade_date&#39;, &#39;next_trade_date&#39;</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="stringliteral">        :return:        string, int, None</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[date][key]</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <a class="code" href="namespaceio.html#a853b98c40a2878e8c0710e0d926c1e4d">logging</a>(<span class="stringliteral">&#39;MktCalendar&#39;</span>, <span class="stringliteral">&#39;[ ERROR ] date:%s or key:%s not in dict&#39;</span> % (date, key))</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac06b41a6125e97b9aca01cf63c795b81">  224</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac06b41a6125e97b9aca01cf63c795b81">gen_date_list_given_range</a>(self, start, end, trade_date_only=True):</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="stringliteral">        given a start date and end date, return a list of dates between them.</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="stringliteral">        :param start:   string, YYYY-MM-DD</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="stringliteral">        :param end:     string, YYYY-MM-DD</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="stringliteral">        :param trade_date_only: boolean</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="stringliteral">        :return:        [] of YYYY-MM-DD</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        idx_start = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(start, <span class="stringliteral">&#39;idx_full_cal&#39;</span>)</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        idx_end = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(end, <span class="stringliteral">&#39;idx_full_cal&#39;</span>)</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> trade_date_only:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.iloc[idx_start][<span class="stringliteral">&#39;mkt_open&#39;</span>]:</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                idx_start = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(start, <span class="stringliteral">&#39;idx_trade_cal&#39;</span>)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                next_trade_date = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(start, <span class="stringliteral">&#39;next_trade_date&#39;</span>)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                idx_start = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(next_trade_date, <span class="stringliteral">&#39;idx_trade_cal&#39;</span>)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>.iloc[idx_end][<span class="stringliteral">&#39;mkt_open&#39;</span>]:</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                idx_end = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(end, <span class="stringliteral">&#39;idx_trade_cal&#39;</span>)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                prev_trade_date = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(end, <span class="stringliteral">&#39;prev_trade_date&#39;</span>)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                idx_end = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(prev_trade_date, <span class="stringliteral">&#39;idx_trade_cal&#39;</span>)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            df = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>[self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>[<span class="stringliteral">&#39;index&#39;</span>] &gt;= idx_start]</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            df = df[df[<span class="stringliteral">&#39;index&#39;</span>] &lt;= idx_end]</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">return</span> df[<span class="stringliteral">&#39;date&#39;</span>].tolist()</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            df = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">full_cal</a>[<span class="stringliteral">&#39;index&#39;</span>] &gt;= idx_start]</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            df = df[df[<span class="stringliteral">&#39;index&#39;</span>] &lt;= idx_end]</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">return</span> df[<span class="stringliteral">&#39;date&#39;</span>].tolist()</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a3e908cdd9ad75f517ae8bdb94a8237f4">  253</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a3e908cdd9ad75f517ae8bdb94a8237f4">parse_date</a>(self, day):</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral">        a date can be describe as TODAY, LASTCLOSEDTRADEDAY, t, T, T+5, t-10,</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="stringliteral">        this function return a proper TRADE DATE YYYY-MM-DD string of it.</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">        :param day:     date description, TODAY, LASTCLOSEDTRADEDAY, t, T, T+5, t-10, etc.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">        :return:        YYYY-MM-DD on Trade Date Calendar which fits it.</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">if</span> (day == <span class="stringliteral">&quot;TODAY&quot;</span>) | (day == <span class="stringliteral">&#39;t&#39;</span>) | (day == <span class="stringliteral">&#39;T&#39;</span>):</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            local_date_now = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(<span class="stringliteral">&#39;d&#39;</span>)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">return</span> local_date_now <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[local_date_now][<span class="stringliteral">&#39;mkt_open&#39;</span>] == 1 <span class="keywordflow">else</span> \</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[local_date_now][<span class="stringliteral">&#39;prev_trade_date&#39;</span>]</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">elif</span> day == <span class="stringliteral">&quot;LASTCLOSEDTRADEDAY&quot;</span>:</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            local_date_now = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(<span class="stringliteral">&#39;d&#39;</span>)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            local_time_now = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(<span class="stringliteral">&#39;t&#39;</span>)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">return</span> local_date_now <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[local_date_now][<span class="stringliteral">&#39;mkt_open&#39;</span>] == 1 <span class="keywordflow">and</span> local_time_now &gt;= <span class="stringliteral">&#39;15:05:00&#39;</span> \</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keywordflow">else</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[local_date_now][<span class="stringliteral">&#39;prev_trade_date&#39;</span>]</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">elif</span> re.search(<span class="stringliteral">r&#39;(\d\d\d\d-\d\d-\d\d)[ \t]*([-+])[ \t]*([\d]+)&#39;</span>, day) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                res = re.search(<span class="stringliteral">r&#39;(\d\d\d\d-\d\d-\d\d)[ \t]*([-+])[ \t]*([\d]+)&#39;</span>, day)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                start = res.group(1)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                oper = res.group(2)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                offset = int(res.group(3))</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="keywordflow">return</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a30d671faddb61286e0acfab458ab9b58">calc_t</a>(start, oper, offset)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <a class="code" href="namespaceio.html#a853b98c40a2878e8c0710e0d926c1e4d">logging</a>(<span class="stringliteral">&quot;MktCalendar&quot;</span>, <span class="stringliteral">&quot;[ ERROR ] parse_date %s %s&quot;</span> % (day, e))</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">elif</span> re.search(<span class="stringliteral">r&#39;[tT][ \t]*([-+])[ \t]*([\d]+)&#39;</span>, day) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            res = re.search(<span class="stringliteral">r&#39;[tT][ \t]*([-+])[ \t]*([\d]+)&#39;</span>, day)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            start = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(<span class="stringliteral">&#39;d&#39;</span>)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            oper = res.group(1)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            offset = int(res.group(2))</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a30d671faddb61286e0acfab458ab9b58">calc_t</a>(start, oper, offset)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">return</span> day</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a4e39a633b8a9d4eb1c76feebc0245bc5">  288</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a4e39a633b8a9d4eb1c76feebc0245bc5">expand_date_in_str</a>(self, target_str):</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="stringliteral">        given a string, search date descriptions enclosed by {{}} and replace them with a valid YYYY-MM-DD on trade date</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="stringliteral">        calendar.</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="stringliteral">        :param target_str:  string</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="stringliteral">        :return:            string, YYYY-MM-DD</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">if</span> re.search(<span class="stringliteral">r&#39;{{TODAY}}|{{[tT]}}&#39;</span>, target_str) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            local_date_now = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(<span class="stringliteral">&#39;d&#39;</span>)</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            str_today = local_date_now <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[local_date_now][<span class="stringliteral">&#39;mkt_open&#39;</span>] == 1 <span class="keywordflow">else</span> \</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[local_date_now][<span class="stringliteral">&#39;prev_trade_date&#39;</span>]</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <span class="keywordflow">return</span> re.sub(<span class="stringliteral">r&quot;{{TODAY}}|{{[tT]}}&quot;</span>, str_today, target_str)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">elif</span> re.search(<span class="stringliteral">r&#39;{{LASTCLOSEDTRADEDAY}}&#39;</span>, target_str) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            local_date_now = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(<span class="stringliteral">&#39;d&#39;</span>)</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            local_time_now = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(<span class="stringliteral">&#39;t&#39;</span>)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            str_today = local_date_now \</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[local_date_now][<span class="stringliteral">&#39;mkt_open&#39;</span>] == 1 <span class="keywordflow">and</span> local_time_now &gt;= <span class="stringliteral">&#39;15:05:00&#39;</span> \</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                <span class="keywordflow">else</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">quick_dict</a>[local_date_now][<span class="stringliteral">&#39;prev_trade_date&#39;</span>]</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">return</span> re.sub(<span class="stringliteral">r&quot;{{LASTCLOSEDTRADEDAY}}&quot;</span>, str_today, target_str)</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">elif</span> re.search(<span class="stringliteral">r&#39;{{(\d\d\d\d-\d\d-\d\d)[ \t]*([-+])[ \t]*([\d]+)}}&#39;</span>, target_str) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="comment"># something like &quot;2018-01-01-5&quot;, &quot;2018-01-01+7&quot;</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            res = re.search(<span class="stringliteral">r&#39;{{(\d\d\d\d-\d\d-\d\d)[ \t]*([-+])[ \t]*([\d]+)}}&#39;</span>, target_str)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            start = res.group(1)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            oper = res.group(2)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            offset = int(res.group(3))</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            str_date = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a30d671faddb61286e0acfab458ab9b58">calc_t</a>(start, oper, offset)</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="keywordflow">return</span> re.sub(<span class="stringliteral">r&#39;{{(\d\d\d\d-\d\d-\d\d)[ \t]*([-+])[ \t]*([\d]+)}}&#39;</span>, str_date, target_str)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">elif</span> re.search(<span class="stringliteral">r&#39;{{[tT][ \t]*([-+])[ \t]*([\d]+)}}&#39;</span>, target_str) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="comment"># something like &quot;T-4&quot;, &quot;t+3&quot;</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            res = re.search(<span class="stringliteral">r&#39;{{[tT][ \t]*([-+])[ \t]*([\d]+)}}&#39;</span>, target_str)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            start = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">now</a>(<span class="stringliteral">&#39;d&#39;</span>)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            oper = res.group(1)</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            offset = int(res.group(2))</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            str_date = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a30d671faddb61286e0acfab458ab9b58">calc_t</a>(start, oper, offset)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">return</span> re.sub(<span class="stringliteral">r&#39;{{[tT][ \t]*([-+])[ \t]*([\d]+)}}&#39;</span>, str_date, target_str)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">return</span> target_str</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a30d671faddb61286e0acfab458ab9b58">  326</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#a30d671faddb61286e0acfab458ab9b58">calc_t</a>(self, start, oper, offset):</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="stringliteral">        return  start_date +- offset(days) in trade date calendar</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="stringliteral">        :param start:   string, YYYY-MM-DD</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="stringliteral">        :param oper:    string, + or -</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="stringliteral">        :param offset:  int</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="stringliteral">        :return:</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(start, <span class="stringliteral">&#39;mkt_open&#39;</span>):</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                idx_start = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(start, <span class="stringliteral">&#39;idx_trade_cal&#39;</span>)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="keywordflow">return</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>.iloc[idx_start + offset][<span class="stringliteral">&#39;date&#39;</span>] <span class="keywordflow">if</span> oper == <span class="stringliteral">&#39;+&#39;</span> <span class="keywordflow">else</span> \</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>.iloc[idx_start - offset][<span class="stringliteral">&#39;date&#39;</span>]</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                <span class="keywordflow">if</span> oper == <span class="stringliteral">&#39;+&#39;</span>:</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    idx_start = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(start, <span class="stringliteral">&#39;prev_trade_date&#39;</span>), <span class="stringliteral">&#39;idx_trade_cal&#39;</span>)</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="keywordflow">return</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>.iloc[idx_start + offset][<span class="stringliteral">&#39;date&#39;</span>]</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    idx_start = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">search</a>(start, <span class="stringliteral">&#39;next_trade_date&#39;</span>), <span class="stringliteral">&#39;idx_trade_cal&#39;</span>)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    <span class="keywordflow">return</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">trade_cal</a>.iloc[idx_start - offset][<span class="stringliteral">&#39;date&#39;</span>]</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <a class="code" href="namespaceio.html#a853b98c40a2878e8c0710e0d926c1e4d">logging</a>(<span class="stringliteral">&quot;MktCalendar&quot;</span>, <span class="stringliteral">&quot;[ ERROR ] calc_t %s%s%d %s&quot;</span> % (start, oper, offset, e))</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">return</span> start</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment"># noinspection PyUnusedLocal</span></div><div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html">  352</a></span>&#160;<span class="keyword">class </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html">MktDateTime</a>:</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="stringliteral">    Important for mkt_monitor. calc how many seconds the market is open between two given time.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#ac775ee34451fdfa742b318538164070e">  356</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, datetime_specified, calendar: MktCalendar):</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="stringliteral">        :param datetime_specified: string, YYYY-MM-DD&amp;HH:mm:SS</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="stringliteral">        :param calendar:           a instance of MktCalendar, fully loaded and updated.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#abcb507037b99f09556f35f77faed70b0">  361</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#abcb507037b99f09556f35f77faed70b0">datetime_specified</a> = datetime_specified</div><div class="line"><a name="l00362"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#af479e73df00a4b00233dd2b7a0667ea4">  362</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#af479e73df00a4b00233dd2b7a0667ea4">datetime_l</a> = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a7b63033ac2b0b629b407359870b80165">  363</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a7b63033ac2b0b629b407359870b80165">datetime_r</a> = <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a36f62e987ae8ce44899c06a3b8c86278">  364</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a36f62e987ae8ce44899c06a3b8c86278">sec_to_l</a> = 0</div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a920cf04bb3e1236b53ca1cdfc730a9ee">  365</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a920cf04bb3e1236b53ca1cdfc730a9ee">sec_to_r</a> = 0</div><div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a48d1b96c9e231515b43cb659b5898ef3">  366</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a48d1b96c9e231515b43cb659b5898ef3">lr_pair</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a28f2ffb3655c34cad74c4fad1325ecf9">  367</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a28f2ffb3655c34cad74c4fad1325ecf9">equiv_date</a> = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a24392e9734248f41dbc6f48326cae0b2">is_in_mkt_close_period</a>(datetime_specified, calendar)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#ae7d6535d41a99597c5708b6f975df255">lr_init</a>(calendar)</div><div class="line"><a name="l00369"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a2566e5bf9bcf115930122b8f7e2e0e41">  369</a></span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a2566e5bf9bcf115930122b8f7e2e0e41">cal</a> = calendar</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a93849b83ff4cc0f03ccc0a263a9b197d">calc_sec_to_lr</a>()</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#ae7d6535d41a99597c5708b6f975df255">  372</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#ae7d6535d41a99597c5708b6f975df255">lr_init</a>(self, calendar: MktCalendar):</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral">        initialize lr pair of MktDateTime</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral">        :param calendar:    a instance of MktCalendar, fully loaded and updated.</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="comment"># should be call with valid self.datetime_specified</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment"># should be called after init self.equiv_date.</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        (d, t) = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a60f629c31eaa1453f7464dadd366ad7d">split_date_time</a>(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#abcb507037b99f09556f35f77faed70b0">datetime_specified</a>)</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a28f2ffb3655c34cad74c4fad1325ecf9">equiv_date</a>:</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">if</span> calendar.search(d, <span class="stringliteral">&#39;mkt_open&#39;</span>) == 0:</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                <span class="comment"># d is not a trade day, navigate to prev, next trade day</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                d_l = calendar.search(d, <span class="stringliteral">&#39;prev_trade_date&#39;</span>)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                d_r = calendar.search(d, <span class="stringliteral">&#39;next_trade_date&#39;</span>)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                t_l = <span class="stringliteral">&quot;15:00:00&quot;</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                t_r = <span class="stringliteral">&quot;09:30:00&quot;</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="comment"># d is a trade day</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <span class="keywordflow">if</span> (<span class="stringliteral">&quot;00:00:00&quot;</span> &lt;= t) &amp; (t &lt;= <span class="stringliteral">&quot;09:30:00&quot;</span>):</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    <span class="comment"># before mkt open</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    d_l = calendar.search(d, <span class="stringliteral">&#39;prev_trade_date&#39;</span>)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                    d_r = d</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                    t_l = <span class="stringliteral">&quot;15:00:00&quot;</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                    t_r = <span class="stringliteral">&quot;09:30:00&quot;</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                <span class="keywordflow">elif</span> (<span class="stringliteral">&quot;11:30:00&quot;</span> &lt;= t) &amp; (t &lt;= <span class="stringliteral">&quot;13:00:00&quot;</span>):</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                    <span class="comment"># lunch break</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                    d_l = d</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    d_r = d</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    t_l = <span class="stringliteral">&quot;11:30:00&quot;</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    t_r = <span class="stringliteral">&quot;13:00:00&quot;</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                <span class="keywordflow">elif</span> (<span class="stringliteral">&quot;15:00:00&quot;</span> &lt;= t) &amp; (t &lt; <span class="stringliteral">&quot;24:00:00&quot;</span>):</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                    <span class="comment"># after mkt close</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    d_l = d</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    d_r = calendar.search(d, <span class="stringliteral">&#39;next_trade_date&#39;</span>)</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    t_l = <span class="stringliteral">&quot;15:00:00&quot;</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    t_r = <span class="stringliteral">&quot;09:30:00&quot;</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    d_l = d</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                    d_r = d</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    t_l = t</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                    t_r = t</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;09:30:00&quot;</span> &lt; t) &amp; (t &lt; <span class="stringliteral">&quot;11:30:00&quot;</span>):</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                d_l = d</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                d_r = d</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                t_l = <span class="stringliteral">&quot;09:30:00&quot;</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                t_r = <span class="stringliteral">&quot;11:30:00&quot;</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordflow">elif</span> (<span class="stringliteral">&quot;13:00:00&quot;</span> &lt; t) &amp; (t &lt; <span class="stringliteral">&quot;15:00:00&quot;</span>):</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                d_l = d</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                d_r = d</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                t_l = <span class="stringliteral">&quot;13:00:00&quot;</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                t_r = <span class="stringliteral">&quot;15:00:00&quot;</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                d_l = d</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                d_r = d</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                t_l = t</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                t_r = t</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#af479e73df00a4b00233dd2b7a0667ea4">datetime_l</a> = <span class="stringliteral">&quot;%s&amp;%s&quot;</span> % (d_l, t_l)</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a7b63033ac2b0b629b407359870b80165">datetime_r</a> = <span class="stringliteral">&quot;%s&amp;%s&quot;</span> % (d_r, t_r)</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a48d1b96c9e231515b43cb659b5898ef3">lr_pair</a> = (self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#af479e73df00a4b00233dd2b7a0667ea4">datetime_l</a>, self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a7b63033ac2b0b629b407359870b80165">datetime_r</a>)</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a93849b83ff4cc0f03ccc0a263a9b197d">  432</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a93849b83ff4cc0f03ccc0a263a9b197d">calc_sec_to_lr</a>(self):</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="stringliteral">        calculate how many seconds between self and it&#39;s left right pair time.</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="comment"># should be called after lr_init</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a28f2ffb3655c34cad74c4fad1325ecf9">equiv_date</a>:</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a36f62e987ae8ce44899c06a3b8c86278">sec_to_l</a> = 0</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a920cf04bb3e1236b53ca1cdfc730a9ee">sec_to_r</a> = 0</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            date_time_format = <span class="stringliteral">&#39;%Y-%m-%d&amp;%H:%M:%S&#39;</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a36f62e987ae8ce44899c06a3b8c86278">sec_to_l</a> = int(</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                (datetime.strptime(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#abcb507037b99f09556f35f77faed70b0">datetime_specified</a>, date_time_format) -</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                 datetime.strptime(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#af479e73df00a4b00233dd2b7a0667ea4">datetime_l</a>, date_time_format)).total_seconds())</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a920cf04bb3e1236b53ca1cdfc730a9ee">sec_to_r</a> = int(</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                (datetime.strptime(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a7b63033ac2b0b629b407359870b80165">datetime_r</a>, date_time_format) -</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                 datetime.strptime(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#abcb507037b99f09556f35f77faed70b0">datetime_specified</a>, date_time_format)).total_seconds())</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a254267b2840c5d61404bd76cfeefc43d">  449</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a254267b2840c5d61404bd76cfeefc43d">secs_to</a>(self, target):</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="stringliteral">        calc how many seconds from this to target time.</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="stringliteral">        :param target:  string, YYYY-MM-DD&amp;HH:mm:SS</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="stringliteral">        :return:</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        date_time_format = <span class="stringliteral">&#39;%Y-%m-%d&amp;%H:%M:%S&#39;</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">return</span> int(</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            (datetime.strptime(target, date_time_format) - datetime.strptime(self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#abcb507037b99f09556f35f77faed70b0">datetime_specified</a>,</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                                                             date_time_format)).total_seconds())</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment"># noinspection PyBroadException,PyMethodMayBeStatic</span></div><div class="line"><a name="l00461"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a60f629c31eaa1453f7464dadd366ad7d">  461</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a60f629c31eaa1453f7464dadd366ad7d">split_date_time</a>(self, target):</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="stringliteral">        given a YYYY-MM-DD&amp;HH:mm:SS, return (YYYY-MM-DD, HH:mm:SS)</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="stringliteral">        :param target: string</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="stringliteral">        :return: set of 2 strings</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            (d, t) = target.split(<span class="stringliteral">&quot;&amp;&quot;</span>)</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            (d, t) = (<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">return</span> d, t</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a24392e9734248f41dbc6f48326cae0b2">  473</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a24392e9734248f41dbc6f48326cae0b2">is_in_mkt_close_period</a>(self, target, calendar: MktCalendar) -&gt; bool:</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="stringliteral">        check whether target time is within market closed period</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="stringliteral">        :param target:      YYYY-MM-DD&amp;HH:mm:SS</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="stringliteral">        :param calendar:    a instance of MktCalendar, fully loaded and updated.</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="stringliteral">        :return:            boolean</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        (d, t) = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a60f629c31eaa1453f7464dadd366ad7d">split_date_time</a>(target)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">if</span> calendar.search(d, <span class="stringliteral">&#39;mkt_open&#39;</span>) == 0:</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;00:00:00&quot;</span> &lt;= t) &amp; (t &lt;= <span class="stringliteral">&quot;09:30:00&quot;</span>):</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="keywordflow">elif</span> (<span class="stringliteral">&quot;11:30:00&quot;</span> &lt;= t) &amp; (t &lt;= <span class="stringliteral">&quot;13:00:00&quot;</span>):</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">elif</span> (<span class="stringliteral">&quot;15:00:00&quot;</span> &lt;= t) &amp; (t &lt; <span class="stringliteral">&quot;24:00:00&quot;</span>):</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno"><a class="line" href="classmarket__calendar__cn_1_1_mkt_date_time.html#ae03b88268c88fb1edfdb3f5353478d7b">  493</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#ae03b88268c88fb1edfdb3f5353478d7b">__sub__</a>(self, other):</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="stringliteral">        calculate how many market open seconds between 2 MktDateTime instances.</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="stringliteral">        :param other:   another MktDateTime instance</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="stringliteral">        :return:        seconds, int</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        a = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#abcb507037b99f09556f35f77faed70b0">datetime_specified</a></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        b = other.datetime_specified</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span> a &gt;= b:</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            positive = <span class="keyword">True</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            positive = <span class="keyword">False</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        large = self <span class="keywordflow">if</span> positive <span class="keywordflow">else</span> other</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        small = other <span class="keywordflow">if</span> positive <span class="keywordflow">else</span> self</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        large_lr_pair = (large.datetime_l, large.datetime_r)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        small_lr_pair = (small.datetime_l, small.datetime_r)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        large_idx = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a2566e5bf9bcf115930122b8f7e2e0e41">cal</a>.lr_pair_dict[large_lr_pair][0]</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        small_idx = self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a2566e5bf9bcf115930122b8f7e2e0e41">cal</a>.lr_pair_dict[small_lr_pair][0]</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">if</span> small_idx != large_idx:</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            secs = small.sec_to_r</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <span class="keywordflow">for</span> idx <span class="keywordflow">in</span> range(small_idx + 1, large_idx):</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a2566e5bf9bcf115930122b8f7e2e0e41">cal</a>.lr_pair_list[idx][2]:</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                    secs += self.<a class="code" href="classmarket__calendar__cn_1_1_mkt_date_time.html#a2566e5bf9bcf115930122b8f7e2e0e41">cal</a>.lr_pair_list[idx][3]</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            secs += large.sec_to_l</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            secs = small.sec_to_r - large.sec_to_r</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span> positive:</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="keywordflow">return</span> secs</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="keywordflow">return</span> -1 * secs</div><div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html">market_calendar_cn.MktCalendar</a></div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00022">market_calendar_cn.py:22</a></div></div>
<div class="ttc" id="namespaceio_html_a853b98c40a2878e8c0710e0d926c1e4d"><div class="ttname"><a href="namespaceio.html#a853b98c40a2878e8c0710e0d926c1e4d">io.logging</a></div><div class="ttdeci">def logging(source, msg, method='mqtt')</div><div class="ttdef"><b>Definition:</b> <a href="io_8py_source.html#l00007">io.py:7</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a65ef493d830b70b37641628efee1fa04"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a65ef493d830b70b37641628efee1fa04">market_calendar_cn.MktCalendar.path_full_cal</a></div><div class="ttdeci">path_full_cal</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00043">market_calendar_cn.py:43</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a470b51db4483fcfde6222f90696c217e"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a470b51db4483fcfde6222f90696c217e">market_calendar_cn.MktCalendar.quick_dict</a></div><div class="ttdeci">quick_dict</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00052">market_calendar_cn.py:52</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a254267b2840c5d61404bd76cfeefc43d"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a254267b2840c5d61404bd76cfeefc43d">market_calendar_cn.MktDateTime.secs_to</a></div><div class="ttdeci">def secs_to(self, target)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00449">market_calendar_cn.py:449</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_af479e73df00a4b00233dd2b7a0667ea4"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#af479e73df00a4b00233dd2b7a0667ea4">market_calendar_cn.MktDateTime.datetime_l</a></div><div class="ttdeci">datetime_l</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00362">market_calendar_cn.py:362</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a93849b83ff4cc0f03ccc0a263a9b197d"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a93849b83ff4cc0f03ccc0a263a9b197d">market_calendar_cn.MktDateTime.calc_sec_to_lr</a></div><div class="ttdeci">def calc_sec_to_lr(self)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00432">market_calendar_cn.py:432</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a8e5eccdc4b86dfd4e896eef215bef286"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8e5eccdc4b86dfd4e896eef215bef286">market_calendar_cn.MktCalendar.market</a></div><div class="ttdeci">market</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00040">market_calendar_cn.py:40</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a9056a7e700d504502353d24a84353efb"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9056a7e700d504502353d24a84353efb">market_calendar_cn.MktCalendar.now</a></div><div class="ttdeci">def now(self, ret_format='dt')</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00059">market_calendar_cn.py:59</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a28f2ffb3655c34cad74c4fad1325ecf9"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a28f2ffb3655c34cad74c4fad1325ecf9">market_calendar_cn.MktDateTime.equiv_date</a></div><div class="ttdeci">equiv_date</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00367">market_calendar_cn.py:367</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_ae7c002587e186285e866e902363cd2c0"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae7c002587e186285e866e902363cd2c0">market_calendar_cn.MktCalendar.trade_cal</a></div><div class="ttdeci">trade_cal</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00051">market_calendar_cn.py:51</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html">market_calendar_cn.MktDateTime</a></div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00352">market_calendar_cn.py:352</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a30d671faddb61286e0acfab458ab9b58"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a30d671faddb61286e0acfab458ab9b58">market_calendar_cn.MktCalendar.calc_t</a></div><div class="ttdeci">def calc_t(self, start, oper, offset)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00326">market_calendar_cn.py:326</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a273ec6bac1529b02391985a902ba857f"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a273ec6bac1529b02391985a902ba857f">market_calendar_cn.MktCalendar.path_lr_pair_list</a></div><div class="ttdeci">path_lr_pair_list</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00046">market_calendar_cn.py:46</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_ac3f63867cb8bf9cea20fdd7bb8abaee5"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac3f63867cb8bf9cea20fdd7bb8abaee5">market_calendar_cn.MktCalendar.load_calendar</a></div><div class="ttdeci">def load_calendar(self)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00143">market_calendar_cn.py:143</a></div></div>
<div class="ttc" id="namespacetools_1_1io_html"><div class="ttname"><a href="namespacetools_1_1io.html">io</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a36f62e987ae8ce44899c06a3b8c86278"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a36f62e987ae8ce44899c06a3b8c86278">market_calendar_cn.MktDateTime.sec_to_l</a></div><div class="ttdeci">sec_to_l</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00364">market_calendar_cn.py:364</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_ae4eef9a337b77e313d5e062b999d9170"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4eef9a337b77e313d5e062b999d9170">market_calendar_cn.MktCalendar.build_quick_dict</a></div><div class="ttdeci">def build_quick_dict(self)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00121">market_calendar_cn.py:121</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a8109498601a070da90e5027ab95b0e50"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a8109498601a070da90e5027ab95b0e50">market_calendar_cn.MktCalendar.load_lr_pair</a></div><div class="ttdeci">def load_lr_pair(self)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00160">market_calendar_cn.py:160</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a4e39a633b8a9d4eb1c76feebc0245bc5"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a4e39a633b8a9d4eb1c76feebc0245bc5">market_calendar_cn.MktCalendar.expand_date_in_str</a></div><div class="ttdeci">def expand_date_in_str(self, target_str)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00288">market_calendar_cn.py:288</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_ae4e96ed8af863b39515fdc5bfa7d275c"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#ae4e96ed8af863b39515fdc5bfa7d275c">market_calendar_cn.MktCalendar.lr_pair_list</a></div><div class="ttdeci">lr_pair_list</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00055">market_calendar_cn.py:55</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_ac2bd5c4d78a5e3976f4278479d0ee7f9"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac2bd5c4d78a5e3976f4278479d0ee7f9">market_calendar_cn.MktCalendar.timezone</a></div><div class="ttdeci">timezone</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00039">market_calendar_cn.py:39</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a6e1ee371ee4a410ca54d56e368cccb38"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a6e1ee371ee4a410ca54d56e368cccb38">market_calendar_cn.MktCalendar.fetch_calendar</a></div><div class="ttdeci">def fetch_calendar(self)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00107">market_calendar_cn.py:107</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a0116b4b1d0367ef73803a42d23fff458"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a0116b4b1d0367ef73803a42d23fff458">market_calendar_cn.MktCalendar.path_quick_dict</a></div><div class="ttdeci">path_quick_dict</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00045">market_calendar_cn.py:45</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_af69941a2b76a04420320c9ae2e468c13"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#af69941a2b76a04420320c9ae2e468c13">market_calendar_cn.MktCalendar.path_trade_cal</a></div><div class="ttdeci">path_trade_cal</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00044">market_calendar_cn.py:44</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a373b8705da9710281ead8203261b5eba"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a373b8705da9710281ead8203261b5eba">market_calendar_cn.MktCalendar.neighbor_trade_date</a></div><div class="ttdeci">def neighbor_trade_date(self, of_which_idx, direction)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00076">market_calendar_cn.py:76</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a9e99dea0131e784ba92591f950ad1f01"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a9e99dea0131e784ba92591f950ad1f01">market_calendar_cn.MktCalendar.lr_pair_dict</a></div><div class="ttdeci">lr_pair_dict</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00056">market_calendar_cn.py:56</a></div></div>
<div class="ttc" id="namespacepath__hdl_html_a297c678baf109aff55206da9d08e5ecd"><div class="ttname"><a href="namespacepath__hdl.html#a297c678baf109aff55206da9d08e5ecd">path_hdl.file_exist</a></div><div class="ttdeci">def file_exist(target_file)</div><div class="ttdef"><b>Definition:</b> <a href="path__hdl_8py_source.html#l00051">path_hdl.py:51</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a91263a5c085639392d263bdcdb1579b9"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a91263a5c085639392d263bdcdb1579b9">market_calendar_cn.MktCalendar.full_cal</a></div><div class="ttdeci">full_cal</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00050">market_calendar_cn.py:50</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_ab83d71ecc48af728de72c8f34608616e"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#ab83d71ecc48af728de72c8f34608616e">market_calendar_cn.MktCalendar.neighbor_trade_date_given_date</a></div><div class="ttdeci">def neighbor_trade_date_given_date(self, of_which_date, direction)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00094">market_calendar_cn.py:94</a></div></div>
<div class="ttc" id="namespacefile__hdl_html_a527e1e4ff7d61672c558c4fefaa414d2"><div class="ttname"><a href="namespacefile__hdl.html#a527e1e4ff7d61672c558c4fefaa414d2">file_hdl.save_pickle</a></div><div class="ttdeci">def save_pickle(obj, path)</div><div class="ttdef"><b>Definition:</b> <a href="file__hdl_8py_source.html#l00082">file_hdl.py:82</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a60f629c31eaa1453f7464dadd366ad7d"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a60f629c31eaa1453f7464dadd366ad7d">market_calendar_cn.MktDateTime.split_date_time</a></div><div class="ttdeci">def split_date_time(self, target)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00461">market_calendar_cn.py:461</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_abcb507037b99f09556f35f77faed70b0"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#abcb507037b99f09556f35f77faed70b0">market_calendar_cn.MktDateTime.datetime_specified</a></div><div class="ttdeci">datetime_specified</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00361">market_calendar_cn.py:361</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_ae7d6535d41a99597c5708b6f975df255"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#ae7d6535d41a99597c5708b6f975df255">market_calendar_cn.MktDateTime.lr_init</a></div><div class="ttdeci">def lr_init</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00372">market_calendar_cn.py:372</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_ac06b41a6125e97b9aca01cf63c795b81"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#ac06b41a6125e97b9aca01cf63c795b81">market_calendar_cn.MktCalendar.gen_date_list_given_range</a></div><div class="ttdeci">def gen_date_list_given_range(self, start, end, trade_date_only=True)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00224">market_calendar_cn.py:224</a></div></div>
<div class="ttc" id="namespacefile__hdl_html_aca9e5fce492fec7b74e93ea7e4a7e5b8"><div class="ttname"><a href="namespacefile__hdl.html#aca9e5fce492fec7b74e93ea7e4a7e5b8">file_hdl.load_pickle</a></div><div class="ttdeci">def load_pickle(path)</div><div class="ttdef"><b>Definition:</b> <a href="file__hdl_8py_source.html#l00067">file_hdl.py:67</a></div></div>
<div class="ttc" id="namespacepath__hdl_html_a23c55bc606a7183504481b311a93be0a"><div class="ttname"><a href="namespacepath__hdl.html#a23c55bc606a7183504481b311a93be0a">path_hdl.directory_ensure</a></div><div class="ttdeci">def directory_ensure(target_directory)</div><div class="ttdef"><b>Definition:</b> <a href="path__hdl_8py_source.html#l00012">path_hdl.py:12</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a920cf04bb3e1236b53ca1cdfc730a9ee"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a920cf04bb3e1236b53ca1cdfc730a9ee">market_calendar_cn.MktDateTime.sec_to_r</a></div><div class="ttdeci">sec_to_r</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00365">market_calendar_cn.py:365</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a2566e5bf9bcf115930122b8f7e2e0e41"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a2566e5bf9bcf115930122b8f7e2e0e41">market_calendar_cn.MktDateTime.cal</a></div><div class="ttdeci">cal</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00369">market_calendar_cn.py:369</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_aed932e732eb4ffe5c854f9226d6eae30"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#aed932e732eb4ffe5c854f9226d6eae30">market_calendar_cn.MktCalendar.search</a></div><div class="ttdeci">def search(self, date, key)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00211">market_calendar_cn.py:211</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a5716151c1c0bdb57228f3bdba6696aa7"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a5716151c1c0bdb57228f3bdba6696aa7">market_calendar_cn.MktCalendar.generate_lr_pair</a></div><div class="ttdeci">def generate_lr_pair(self)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00173">market_calendar_cn.py:173</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_af48e398f69caa9289fbb1351b697e03d"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#af48e398f69caa9289fbb1351b697e03d">market_calendar_cn.MktCalendar.path_lr_pair_dict</a></div><div class="ttdeci">path_lr_pair_dict</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00047">market_calendar_cn.py:47</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a7ea0dda03522caa37e91076040b6f81a"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a7ea0dda03522caa37e91076040b6f81a">market_calendar_cn.MktCalendar.date_boundary</a></div><div class="ttdeci">date_boundary</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00049">market_calendar_cn.py:49</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a24392e9734248f41dbc6f48326cae0b2"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a24392e9734248f41dbc6f48326cae0b2">market_calendar_cn.MktDateTime.is_in_mkt_close_period</a></div><div class="ttdeci">def is_in_mkt_close_period</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00473">market_calendar_cn.py:473</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a48d1b96c9e231515b43cb659b5898ef3"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a48d1b96c9e231515b43cb659b5898ef3">market_calendar_cn.MktDateTime.lr_pair</a></div><div class="ttdeci">lr_pair</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00366">market_calendar_cn.py:366</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_a7b63033ac2b0b629b407359870b80165"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#a7b63033ac2b0b629b407359870b80165">market_calendar_cn.MktDateTime.datetime_r</a></div><div class="ttdeci">datetime_r</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00363">market_calendar_cn.py:363</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_ae03b88268c88fb1edfdb3f5353478d7b"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#ae03b88268c88fb1edfdb3f5353478d7b">market_calendar_cn.MktDateTime.__sub__</a></div><div class="ttdeci">def __sub__(self, other)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00493">market_calendar_cn.py:493</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a3e908cdd9ad75f517ae8bdb94a8237f4"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a3e908cdd9ad75f517ae8bdb94a8237f4">market_calendar_cn.MktCalendar.parse_date</a></div><div class="ttdeci">def parse_date(self, day)</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00253">market_calendar_cn.py:253</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_calendar_html_a480f8d7db6d812ee624d4be7e1372c5f"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_calendar.html#a480f8d7db6d812ee624d4be7e1372c5f">market_calendar_cn.MktCalendar.__init__</a></div><div class="ttdeci">def __init__(self, tz='Asia/Shanghai', mkt='CN')</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00030">market_calendar_cn.py:30</a></div></div>
<div class="ttc" id="namespacepath__hdl_html_ae87fc63ccf0676ae841291bbf8c0e2dc"><div class="ttname"><a href="namespacepath__hdl.html#ae87fc63ccf0676ae841291bbf8c0e2dc">path_hdl.path_expand</a></div><div class="ttdeci">def path_expand(path)</div><div class="ttdef"><b>Definition:</b> <a href="path__hdl_8py_source.html#l00074">path_hdl.py:74</a></div></div>
<div class="ttc" id="classmarket__calendar__cn_1_1_mkt_date_time_html_ac775ee34451fdfa742b318538164070e"><div class="ttname"><a href="classmarket__calendar__cn_1_1_mkt_date_time.html#ac775ee34451fdfa742b318538164070e">market_calendar_cn.MktDateTime.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdef"><b>Definition:</b> <a href="market__calendar__cn_8py_source.html#l00356">market_calendar_cn.py:356</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
